<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <script src="https://cdn.jsdelivr.net/npm/hls.js@1"></script>
    <style>
        body { margin: 0; background: #000; overflow: hidden; display: flex; flex-direction: column; height: 100vh; }
        video { width: 100%; height: 100%; object-fit: contain; }
        
        /* --- é¡¶éƒ¨æ„Ÿåº”åŒºåŸŸ --- */
        .top-hover-zone {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 80px; z-index: 200;
            display: flex; flex-direction: column;
        }

        /* --- æ§åˆ¶æ æ ·å¼ --- */
        .controls {
            width: 100%;
            background: rgba(0,0,0,0.85);
            display: flex;
            align-items: center;
            padding: 8px 10px;
            box-sizing: border-box;
            
            opacity: 0;
            transform: translateY(-100%);
            transition: all 0.3s ease;
            
            /* å…è®¸æ‹–æ‹½èƒŒæ™¯ */
            -webkit-app-region: drag; 
        }

        .top-hover-zone:hover .controls {
            opacity: 1;
            transform: translateY(0);
        }
        
        /* é€šç”¨æŒ‰é’®æ ·å¼ */
        input { 
            flex: 1; font-size: 12px; margin-right: 8px; outline: none; padding: 4px; 
            background: #333; color: white; border: 1px solid #555; border-radius: 4px;
            -webkit-app-region: no-drag; 
        }
        button { 
            font-size: 12px; cursor: pointer; margin-right: 5px; padding: 4px 8px; 
            background: #444; color: white; border: 1px solid #666; border-radius: 4px;
            -webkit-app-region: no-drag; /* æ™®é€šæŒ‰é’®ä¸å¯æ‹–æ‹½ */
        }
        button:hover { background: #666; }
        
        /* --- ã€å…³é”®ä¿®æ”¹ã€‘ç§»åŠ¨æ‰‹æŸ„ä¸“ç”¨æ ·å¼ (Divæ¨¡æ‹ŸæŒ‰é’®) --- */
        .btn-move {
            /* 1. æ ¸å¿ƒï¼šå…è®¸æ‹–æ‹½ */
            -webkit-app-region: drag !important; 
            
            /* 2. å¸ƒå±€ï¼šè®©divçœ‹èµ·æ¥åƒæŒ‰é’® */
            display: inline-flex;
            justify-content: center;
            align-items: center;
            box-sizing: border-box;
            
            /* 3. å¤–è§‚ï¼šå¤åˆ»æ™®é€šæŒ‰é’®æ ·å¼ */
            width: 26px;  /* å›ºå®šå®½åº¦ï¼Œæ›´å¥½çœ‹ */
            height: 24px; /* é«˜åº¦åŒ¹é…æ—è¾¹æŒ‰é’® */
            font-size: 14px;
            margin-right: 5px; 
            
            cursor: move; /* é¼ æ ‡æ ·å¼ */
            background: #2b5c82; 
            color: white; 
            border: 1px solid #3e7ca8; 
            border-radius: 4px;
            
            /* 4. ç»†èŠ‚ï¼šé˜²æ­¢æ‹–æ‹½æ—¶æ–‡å­—è¢«é€‰ä¸­ */
            -webkit-user-select: none;
            user-select: none;
        }
        .btn-move:hover { background: #3e7ca8; }

        /* ç½®é¡¶æŒ‰é’® */
        #btnTop { font-size: 14px; padding: 2px 6px; }

        /* å³ä¾§çª—å£æŒ‰é’®ç»„ */
        .win-controls { display: flex; align-items: center; margin-left: 10px; }
        .btn-close { background: #c00; border-color: #a00; }
        .btn-close:hover { background: #f00; }
    </style>
</head>
<body>
    
    <div class="top-hover-zone">
        <div class="controls">
            <input type="text" id="urlInput" placeholder="ç²˜è´´ .m3u8 é“¾æ¥ æˆ– æ‹–å…¥æ–‡ä»¶">
            
            <button id="btnTop" onclick="toggleTop()" title="ç½®é¡¶/å–æ¶ˆ">ğŸ“Œ</button>
            <button onclick="playInput()">æ’­æ”¾</button>
            <button onclick="toggleSize()">æ‘¸é±¼/æ¢å¤</button>
            
            <div class="win-controls" id="winBtns" style="display:none;">
                <div class="btn-move" title="æŒ‰ä½æ‹–åŠ¨çª—å£">âœ¥</div>
                
                <button onclick="winMin()" title="æœ€å°åŒ–">-</button>
                <button class="btn-close" onclick="winClose()" title="å…³é—­">Ã—</button>
            </div>
        </div>
    </div>

    <video id="vPlayer" controls autoplay></video>

    <script>
        const PORT = "{{PORT}}";
        const video = document.getElementById('vPlayer');
        const input = document.getElementById('urlInput');
        const winBtns = document.getElementById('winBtns');
        let isMini = false;
        let isTop = false;
        let hls = null;

        function playInput() {
            let val = input.value;
            if (!val) return;
            if (!val.startsWith('http') && !val.startsWith('blob:')) {
                val = `http://127.0.0.1:${PORT}/${val}`;
            }
            loadVideo(val);
        }

        function loadVideo(src) {
            if (hls) { hls.destroy(); hls = null; }
            if (src.includes('.m3u8')) {
                if (Hls.isSupported()) {
                    hls = new Hls();
                    hls.loadSource(src);
                    hls.attachMedia(video);
                    hls.on(Hls.Events.MANIFEST_PARSED, function() { video.play(); });
                } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
                    video.src = src;
                    video.addEventListener('loadedmetadata', function() { video.play(); });
                }
            } else {
                video.src = src;
                video.play();
            }
        }

        function toggleSize() {
            isMini = !isMini;
            toggleMode(isMini); 
            
            if(isMini) {
                // æ‘¸é±¼æ¨¡å¼ï¼šæ˜¾ç¤ºåŠŸèƒ½é”®ï¼Œå…¨å±æ„Ÿåº”
                winBtns.style.display = 'flex';
                document.querySelector('.top-hover-zone').style.height = '100%'; 
            } else {
                // æ­£å¸¸æ¨¡å¼
                winBtns.style.display = 'none';
                document.querySelector('.top-hover-zone').style.height = '80px';
            }
        }

        function toggleTop() {
            isTop = !isTop;
            window.setTop(isTop);
            const btn = document.getElementById('btnTop');
            if (isTop) {
                btn.style.background = '#2ea44f';
                btn.style.borderColor = '#2ea44f';
            } else {
                btn.style.background = '#444';
                btn.style.borderColor = '#666';
            }
        }

        // æ‹–æ‹½æ–‡ä»¶æ”¯æŒ
        document.body.addEventListener('dragover', e => e.preventDefault());
        document.body.addEventListener('drop', e => {
            e.preventDefault();
            if (e.dataTransfer.files.length > 0) {
                const file = e.dataTransfer.files[0];
                loadVideo(URL.createObjectURL(file));
            }
        });
        
        // åŒå‡»æš‚åœ/æ’­æ”¾ (æ’é™¤æŒ‰é’®å’Œæ§åˆ¶æ èƒŒæ™¯çš„å¹²æ‰°)
        document.body.addEventListener('dblclick', (e) => {
            if(e.target.tagName === 'BUTTON' || e.target.tagName === 'INPUT') return;
            if(e.target.closest('.controls')) return; 
            
            if(video.paused) video.play(); else video.pause();
        });
    </script>
</body>
</html>